from PySide6.QtWidgets import (
    QApplication, QMainWindow, QWidget, QVBoxLayout,
    QFormLayout, QGroupBox, QComboBox, QPushButton, QGridLayout
)
import yaml

class EOLPanel(QWidget):
    def __init__(self, eol_data):
        super().__init__()
        self.init_ui(eol_data)

    def init_ui(self, eol_data):
        layout = QGridLayout()
        row, col = 0, 0
        max_columns = 3  # 한 행에 몇 개의 버튼을 배치할지 결정

        for field in eol_data['DataFields']:
            button = QPushButton(field['Name'])
            button.clicked.connect(lambda checked, name=field['Name']: self.button_clicked(name))
            layout.addWidget(button, row, col)

            col += 1
            if col >= max_columns:
                col = 0
                row += 1

        send_button = QPushButton("Send")
        send_button.clicked.connect(self.send_data)
        layout.addWidget(send_button, row + 1, 0, 1, max_columns)  # 마지막 줄에 걸쳐서 배치

        self.setLayout(layout)

    def button_clicked(self, name):
        print(f"Button {name} clicked")

    def send_data(self):
        # 여기에 선택된 값을 바탕으로 CAN 프레임을 구성하여 전송하는 로직을 추가합니다.
        pass

class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.init_ui()

    def init_ui(self):
        central_widget = QWidget()
        layout = QVBoxLayout(central_widget)

        # YAML 파일을 UTF-8 인코딩으로 읽습니다.
        with open("eol_coding.yml", "r", encoding="utf-8") as file:
            eol_data = yaml.safe_load(file)["EOL_Coding"]

        eol_panel = EOLPanel(eol_data)
        layout.addWidget(eol_panel)

        self.setCentralWidget(central_widget)

app = QApplication([])
window = MainWindow()
window.show()
app.exec()
